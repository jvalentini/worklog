{"id":"wl-wb1","title":"Project-mode attribution + trends + cron+slack hardening","description":"Refactor project-centric reporting so every WorkItem is attributed to a configured repo when evidence exists, otherwise placed under a Misc bucket. Wire up --trends by comparing current vs previous equivalent period. Harden cron Slack posting by moving posting into a CLI subcommand to avoid shell-quoting/injection issues.","design":"Key files: bin/worklog.ts (CLI), src/aggregator.ts (grouping), src/formatters/projects.ts (rendering), src/utils/trends.ts (trend calc), src/cron.ts (cron install/status). Implement attribution via a single resolver (new util) used by aggregation. Prefer longest-path repo match. Avoid writing temp files in tests (no deletions); favor pure helpers and injected adapters.","acceptance_criteria":"1) In project mode, activity from all enabled sources appears either under a project or under Misc. 2) --trends prints deterministic trend output for each format and is covered by unit tests. 3) cron install with --slack produces a robust cron line that posts to Slack without shell quoting hacks. 4) bun test and bun run check pass.","status":"open","priority":1,"issue_type":"epic","estimated_minutes":480,"created_at":"2026-01-02T10:51:31.144830663-05:00","updated_at":"2026-01-02T10:51:31.144830663-05:00"}
{"id":"wl-wb1.1","title":"Align CLI version with package.json","description":"bin/worklog.ts currently hardcodes VERSION=0.1.0 while package.json is 2.0.0; make --version reflect the real release version.","design":"Update bin/worklog.ts:14 (VERSION). Prefer a single source of truth (package.json). Consider runtime JSON import or reading via Bun.file; ensure it works when bun build --compile is used. Update src/worklog.test.ts:17-25 accordingly.","acceptance_criteria":"1) worklog --version prints the package.json version. 2) src/worklog.test.ts version expectation updated. 3) bun test and bun run check pass.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":45,"created_at":"2026-01-02T10:52:56.834090634-05:00","updated_at":"2026-01-02T13:52:48.206391838-05:00","closed_at":"2026-01-02T13:52:48.206391838-05:00","close_reason":"Completed: Version now imports from package.json and displays 2.0.0. Tests pass.","dependencies":[{"issue_id":"wl-wb1.1","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:52:56.834612947-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.10","title":"Infer repo attribution for OpenCode sessions","description":"opencode reader currently emits sessions without repo/project metadata, so they are dropped or go to Misc. Enhance parsing to look for file path evidence in user/assistant messages or tool logs, and attribute sessions to the configured repo containing those paths (longest-path match).","design":"Files: src/sources/opencode.ts. Add helper that extracts candidate file paths from message content (absolute paths and common patterns like src/... if repo root known). Use resolver wl-wb1.4 for mapping. Keep current behavior of using first user prompt for title; only add metadata.repo/project when evidence exists.","acceptance_criteria":"1) If any message line contains a file path under a configured repo, the session WorkItem is attributed to that repo. 2) If no evidence exists, session goes to Misc. 3) Deterministic unit tests exist using in-memory JSONL strings and a fake Config.gitRepos list (no filesystem).","status":"closed","priority":1,"issue_type":"task","assignee":"Sisyphus","estimated_minutes":120,"created_at":"2026-01-02T10:55:12.861231717-05:00","updated_at":"2026-01-02T14:24:31.512041882-05:00","closed_at":"2026-01-02T14:24:31.512041882-05:00","close_reason":"Completed: Implemented repo attribution for OpenCode sessions by extracting file paths from message content and matching to configured repos. Added extractFilePaths() and findRepoFromMessages() helpers. Created comprehensive test suite with 23 passing tests. All checks pass.","dependencies":[{"issue_id":"wl-wb1.10","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:55:12.861861163-05:00","created_by":"daemon"},{"issue_id":"wl-wb1.10","depends_on_id":"wl-wb1.4","type":"blocks","created_at":"2026-01-02T10:58:28.777875497-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.11","title":"Infer repo attribution for Codex sessions","description":"codex reader currently emits sessions without repo/project metadata. Enhance parsing to look for file path evidence in messages and attribute to configured repos when possible; otherwise Misc.","design":"Files: src/sources/codex.ts. Similar approach to wl-wb1.10. Prefer extracting file paths from user prompts and tool output-like strings. Use longest-path match against expanded config.gitRepos.","acceptance_criteria":"1) If message content contains a file path under a configured repo, the session WorkItem is attributed to that repo. 2) Otherwise goes to Misc. 3) Deterministic unit tests exist using in-memory JSONL strings (no filesystem).","status":"closed","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2026-01-02T10:55:12.889150841-05:00","updated_at":"2026-01-02T14:28:59.341072088-05:00","closed_at":"2026-01-02T14:28:59.341072088-05:00","close_reason":"Completed: Implemented repo attribution for Codex sessions with comprehensive tests. All acceptance criteria met.","dependencies":[{"issue_id":"wl-wb1.11","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:55:12.889859009-05:00","created_by":"daemon"},{"issue_id":"wl-wb1.11","depends_on_id":"wl-wb1.4","type":"blocks","created_at":"2026-01-02T10:58:28.803875013-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.12","title":"Wire up --trends end-to-end","description":"Implement the --trends flag so it computes current vs previous equivalent period trends using src/utils/trends.ts and renders them in markdown/plain/slack/json outputs.","design":"Files: bin/worklog.ts (flag handling), src/utils/trends.ts (already has getPreviousDateRange/calculateTrends/formatTrendSummary), src/formatters/projects.ts or new formatter helpers. Implementation approach: when --trends is set, collect a previous WorkSummary by re-running readers with previous range; then compute TrendData and include it in output. Avoid time-dependent tests; use fixed Dates and in-memory WorkSummary fixtures.","acceptance_criteria":"1) worklog --trends produces a trend section instead of the current coming-soon warning. 2) Trend computation uses previous equivalent date range and same sources selection. 3) Unit tests exist for trend range + calculations with deterministic fixtures. 4) Output is supported for markdown/plain/slack/json (JSON includes a trends object). 5) bun test and bun run check pass.","status":"closed","priority":1,"issue_type":"feature","assignee":"Sisyphus","estimated_minutes":120,"created_at":"2026-01-02T10:56:23.032363192-05:00","updated_at":"2026-01-02T14:34:19.282037046-05:00","closed_at":"2026-01-02T14:34:19.282037046-05:00","close_reason":"Completed: Implemented end-to-end --trends functionality with full format support and comprehensive tests","dependencies":[{"issue_id":"wl-wb1.12","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:56:23.033041933-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.13","title":"Add cron Slack posting helper subcommand","description":"Replace cron install Slack piping with a safe CLI subcommand that renders output and posts to Slack via fetch, avoiding shell quoting issues in src/cron.ts.","design":"Files: src/cron.ts and bin/worklog.ts. Consider storing webhook in env var or passing as flag with robust quoting; prefer minimal shell in cron line. Implement Slack post by generating Slack-format output and calling fetch(webhook, {method: POST, body: JSON.stringify({text})}). Add tests for buildCronLine output using fixed inputs.","acceptance_criteria":"1) A new cron subcommand exists (e.g. worklog cron run or worklog cron post-slack) that can post to Slack without using curl or shell quoting hacks. 2) src/cron.ts buildCronLine uses the subcommand for --slack installs. 3) Unit tests validate cron line generation is stable and does not embed raw JSON quoting patterns. 4) bun test and bun run check pass.","status":"closed","priority":1,"issue_type":"feature","assignee":"sisyphus","estimated_minutes":150,"created_at":"2026-01-02T10:56:23.080324838-05:00","updated_at":"2026-01-02T14:42:12.47099076-05:00","closed_at":"2026-01-02T14:42:12.47099076-05:00","close_reason":"Completed: Added 'worklog cron run' subcommand that posts to Slack via fetch, avoiding shell quoting issues. Webhook is set as WORKLOG_SLACK_WEBHOOK environment variable in crontab. All tests pass.","dependencies":[{"issue_id":"wl-wb1.13","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:56:23.081508187-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.14","title":"Deduplicate JSONL traversal and subject cleaning helpers","description":"Reduce duplicate helper logic: findJsonlFiles duplicated in src/sources/claude.ts and src/sources/factory.ts; cleanSubject duplicated in src/llm.ts and src/formatters/projects.ts.","design":"Extract findJsonlFiles to a shared module under src/utils or src/sources/_shared. Extract cleanSubject into src/utils/commitSubjects.ts (or similar) and import from both llm and formatter. Keep changes small; no behavior changes.","acceptance_criteria":"1) Shared helper(s) introduced and used by both call sites. 2) Behavior remains identical (verified by existing tests + new targeted unit tests where needed). 3) bun test and bun run check pass.","status":"closed","priority":3,"issue_type":"chore","assignee":"sisyphus","estimated_minutes":90,"created_at":"2026-01-02T10:56:23.131792149-05:00","updated_at":"2026-01-02T14:08:20.803267792-05:00","closed_at":"2026-01-02T14:08:20.803267792-05:00","close_reason":"Completed: Extracted findJsonlFiles and cleanSubject to shared utility modules. All tests passing.","dependencies":[{"issue_id":"wl-wb1.14","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:56:23.132319824-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.15","title":"Dashboard handles empty summary safely","description":"src/utils/dashboard.ts computes percentage as count/summary.items.length; when items is empty, this becomes NaN. Guard against empty input and render 0s instead.","design":"Change chartData percentage calculation to return 0 when total==0. Consider also guarding Math.max(...hourlyData) and other derived metrics if needed.","acceptance_criteria":"1) Dashboard renders without NaN when summary.items is empty. 2) Add a deterministic unit test for generateDashboardHTML with an empty WorkSummary fixture. 3) bun test and bun run check pass.","status":"closed","priority":4,"issue_type":"chore","assignee":"Sisyphus","estimated_minutes":30,"created_at":"2026-01-02T10:56:23.179334878-05:00","updated_at":"2026-01-02T14:05:22.439099766-05:00","closed_at":"2026-01-02T14:05:22.439099766-05:00","close_reason":"Fixed percentage calculation and Math.max to handle empty summaries. Added comprehensive unit tests.","dependencies":[{"issue_id":"wl-wb1.15","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:56:23.180683382-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.2","title":"Remove commander casts for --sources/--repos","description":"bin/worklog.ts currently uses unsafe type casts to treat --sources/--repos as strings. Remove the casts by making commander option types match and parsing comma-separated lists in a typed way.","design":"Files: bin/worklog.ts and src/types.ts. Options: (A) keep CliOptions.sources and repos as strings and split once, (B) define commander option parsers that return string[] and update CliOptions accordingly. Prefer Commander program.opts\u003cT\u003e() or typed action parameter instead of casting. Ensure README comma-separated usage still works. Add/adjust src/worklog.test.ts to cover --sources and --repos parsing deterministically.","acceptance_criteria":"1) No unsafe cast remains in bin/worklog.ts. 2) src/types.ts CliOptions matches actual runtime options. 3) worklog --help and existing e2e tests still pass; add a new e2e test for parsing comma-separated sources/repos.","status":"closed","priority":2,"issue_type":"task","assignee":"sisyphus","estimated_minutes":60,"created_at":"2026-01-02T10:52:56.881240622-05:00","updated_at":"2026-01-02T13:55:27.633390468-05:00","closed_at":"2026-01-02T13:55:27.633390468-05:00","close_reason":"Completed: Removed unsafe type casts by adding parseCommaSeparated helper and applying it to Commander options. All tests passing.","dependencies":[{"issue_id":"wl-wb1.2","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:52:56.881802242-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.3","title":"Fix expandPath tilde semantics","description":"src/utils/config.ts expandPath currently expands any string starting with '~' via join(homedir(), path.slice(1)); tighten semantics to expand only ~, ~/..., and ~\\...","design":"Update src/utils/config.ts:45-50. Keep function pure and cross-platform; avoid introducing new deps. Add tests for the edge cases above.","acceptance_criteria":"1) expandPath('~') returns homedir; expandPath('~/x') and expandPath('~\\x') join correctly; expandPath('~user') remains unchanged. 2) src/utils/config.test.ts updated/extended. 3) bun test and bun run check pass.","status":"closed","priority":2,"issue_type":"task","assignee":"Sisyphus","estimated_minutes":30,"created_at":"2026-01-02T10:52:56.911192019-05:00","updated_at":"2026-01-02T13:57:38.431484481-05:00","closed_at":"2026-01-02T13:57:38.431484481-05:00","close_reason":"Fixed expandPath to only expand ~, ~/, and ~\\ patterns (not ~user). Added comprehensive tests. All checks pass.","dependencies":[{"issue_id":"wl-wb1.3","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:52:56.911685635-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.4","title":"Add project attribution resolver (repo-or-misc)","description":"Create a single attribution function that maps a WorkItem to a configured git repo when evidence exists, otherwise returns misc. This replaces ad-hoc matching spread across aggregator/formatters.","design":"Add new module under src/utils (e.g. src/utils/attribution.ts). Inputs: WorkItem + Config (gitRepos) + maybe precomputed normalized repo map. Rules: (a) if item.metadata.repo is a path, match to expanded config.gitRepos by prefix (prefer longest). (b) if item.metadata.repo is owner/name, match by repo basename to configured repos. (c) if item.metadata.project is present, match by normalized name to repo basename. Else misc. Add unit tests using in-memory WorkItem objects (no filesystem). Files to touch later: src/aggregator.ts should call this resolver.","acceptance_criteria":"1) A pure resolver exists with unit tests covering: metadata.repo, metadata.project, github owner/repo strings, and longest-path match for nested repos. 2) Resolver behavior is deterministic and documented in code. 3) No other module re-implements repo matching logic.","status":"closed","priority":1,"issue_type":"task","assignee":"Sisyphus","estimated_minutes":120,"created_at":"2026-01-02T10:54:47.261553009-05:00","updated_at":"2026-01-02T13:46:12.080009525-05:00","closed_at":"2026-01-02T13:46:12.080009525-05:00","close_reason":"Completed: Created src/utils/attribution.ts with attributeWorkItem() function that supports path-based, GitHub owner/repo, and project name matching. Includes comprehensive test suite with 21 passing tests covering all attribution rules and edge cases. All checks pass.","dependencies":[{"issue_id":"wl-wb1.4","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:54:47.262552738-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.5","title":"Update aggregation to include Misc bucket","description":"Modify src/aggregator.ts and src/types.ts so project-centric aggregation always produces a Misc project bucket when there are unattributed items (or when no gitRepos are configured). Use the new resolver to assign items.","design":"Refactor aggregateByProject() to build projects only from configured gitRepos plus an optional misc project. Ensure daily grouping works for misc the same way. Keep project ordering stable (projects alpha, misc last). Remove getProjectFromWorkItem() usage in favor of resolver.","acceptance_criteria":"1) Items from any source that cannot be mapped land under Misc instead of being dropped. 2) When config.gitRepos is empty, git/github/agent items still appear under Misc. 3) src/aggregator.test.ts updated with deterministic fixtures covering misc behavior. 4) bun test and bun run check pass.","status":"closed","priority":1,"issue_type":"task","assignee":"Sisyphus","estimated_minutes":90,"created_at":"2026-01-02T10:54:47.288250099-05:00","updated_at":"2026-01-02T13:49:49.959868869-05:00","closed_at":"2026-01-02T13:49:49.959868869-05:00","close_reason":"Completed: Implemented Misc bucket for unattributed items. All items now either match a configured repo or go to Misc. Added comprehensive tests covering edge cases.","dependencies":[{"issue_id":"wl-wb1.5","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:54:47.288653261-05:00","created_by":"daemon"},{"issue_id":"wl-wb1.5","depends_on_id":"wl-wb1.4","type":"blocks","created_at":"2026-01-02T10:58:28.637274744-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.6","title":"Render Misc bucket in all output formats","description":"Update src/formatters/projects.ts so Misc is rendered like a normal project section in markdown/plain/slack/json. Ensure verbose and non-verbose modes behave consistently.","design":"Files: src/formatters/projects.ts and possibly src/formatters/index.ts. Introduce a small formatter test file under src/formatters to validate output strings (pure string tests). Do not rely on timezones; use fixed Dates.","acceptance_criteria":"1) Markdown/plain/slack output includes a Misc section when misc items exist. 2) JSON output includes misc as a project entry with name Misc and path null or empty. 3) Add formatter unit tests that assert misc rendering for a small ProjectWorkSummary fixture. 4) bun test and bun run check pass.","status":"closed","priority":1,"issue_type":"task","assignee":"Sisyphus","estimated_minutes":90,"created_at":"2026-01-02T10:54:47.315947272-05:00","updated_at":"2026-01-02T14:02:51.239605168-05:00","closed_at":"2026-01-02T14:02:51.239605168-05:00","close_reason":"Completed: Added comprehensive formatter tests for Misc bucket rendering in markdown/plain/slack/json formats. JSON output now returns null for Misc project path. All tests pass.","dependencies":[{"issue_id":"wl-wb1.6","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:54:47.316452886-05:00","created_by":"daemon"},{"issue_id":"wl-wb1.6","depends_on_id":"wl-wb1.5","type":"blocks","created_at":"2026-01-02T10:58:28.664515038-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.7","title":"Attribute VS Code and Cursor activity to repos","description":"vscode/cursor readers emit workspace folderUri but no repo/project; add attribution by mapping folderUri paths to configured gitRepos and setting metadata.repo (or relying on resolver).","design":"Files: src/sources/vscode.ts and src/sources/cursor.ts. Implement a pure helper: parseFileUriToPath(uri) -\u003e string | null (handle file://, percent-decoding, and Windows drive paths). Then use the attribution resolver (wl-wb1.4) to match against expanded config.gitRepos by prefix/longest path.","acceptance_criteria":"1) When folderUri points inside a configured repo path, the resulting WorkItem is attributed to that repo in project mode (not Misc). 2) If folderUri cannot be parsed or does not match any configured repo, item goes to Misc. 3) Add deterministic unit tests for URI parsing + path-to-repo matching (no real VS Code dirs).","status":"closed","priority":1,"issue_type":"task","assignee":"Sisyphus","estimated_minutes":90,"created_at":"2026-01-02T10:55:12.771533267-05:00","updated_at":"2026-01-02T14:12:17.345096284-05:00","closed_at":"2026-01-02T14:12:17.345096284-05:00","close_reason":"Completed: Implemented parseFileUriToPath() helper in both vscode.ts and cursor.ts to parse file:// URIs with percent-decoding and Windows path support. WorkItems now include metadata.repo extracted from folderUri, enabling automatic attribution to configured repos. Added 58 comprehensive tests covering all path formats and edge cases. All tests and checks pass.","dependencies":[{"issue_id":"wl-wb1.7","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:55:12.772133419-05:00","created_by":"daemon"},{"issue_id":"wl-wb1.7","depends_on_id":"wl-wb1.4","type":"blocks","created_at":"2026-01-02T10:58:28.692799316-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.8","title":"Refactor filesystem source to be repo-centric","description":"filesystem reader currently scans a single broad base path and emits one global summary without repo/project metadata. Change it to scan each configured git repo and emit one WorkItem per repo (plus optional misc summary if desired).","design":"Files: src/sources/filesystem.ts. Introduce an optional dependency-injection parameter or internal adapter object for readdir/stat, so tests can provide an in-memory directory tree with known mtimes. Keep default production behavior using node:fs/promises. Ensure skipDirs still applied.","acceptance_criteria":"1) For each configured git repo, filesystem reader returns an item with metadata.repo set to that repo and stats limited to that repo. 2) Items appear under the correct repo section in project mode. 3) Deterministic tests exist by injecting a fake fs adapter (no temp dirs/files).","status":"closed","priority":1,"issue_type":"task","assignee":"sisyphus","estimated_minutes":120,"created_at":"2026-01-02T10:55:12.801113763-05:00","updated_at":"2026-01-02T14:18:51.986237123-05:00","closed_at":"2026-01-02T14:18:51.986237123-05:00","close_reason":"Completed: Refactored filesystem source to scan each configured git repo separately and emit one WorkItem per repo with metadata.repo and metadata.project. Added FilesystemAdapter interface for dependency injection and comprehensive tests using in-memory filesystem adapter.","dependencies":[{"issue_id":"wl-wb1.8","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:55:12.801753636-05:00","created_by":"daemon"},{"issue_id":"wl-wb1.8","depends_on_id":"wl-wb1.4","type":"blocks","created_at":"2026-01-02T10:58:28.718794719-05:00","created_by":"daemon"}]}
{"id":"wl-wb1.9","title":"Attribute terminal activity using cd timeline heuristics","description":"terminal reader aggregates commands globally. Add best-effort repo attribution by parsing cd commands in timestamped history entries, tracking current working directory over time, and attributing subsequent commands to the last-known repo when it matches configured gitRepos.","design":"Files: src/sources/terminal.ts. Refactor to separate parsing of history content into events (timestamp, commandLine). Track cwd changes when command is cd. Attribute commands by last cwd at or before timestamp. Keep existing ignore list behavior but do not ignore cd for the attribution state machine.","acceptance_criteria":"1) When history contains timestamped cd into a configured repo, subsequent commands within the dateRange are attributed to that repo (not Misc). 2) When cwd cannot be inferred, fall back to Misc. 3) Deterministic unit tests exist using in-memory history strings for bash/zsh/fish formats.","status":"closed","priority":1,"issue_type":"task","assignee":"Sisyphus","estimated_minutes":120,"created_at":"2026-01-02T10:55:12.829777461-05:00","updated_at":"2026-01-02T14:54:41.092774344-05:00","closed_at":"2026-01-02T14:54:41.092774344-05:00","close_reason":"Terminal attribution implemented with cd timeline tracking. All tests pass.","dependencies":[{"issue_id":"wl-wb1.9","depends_on_id":"wl-wb1","type":"parent-child","created_at":"2026-01-02T10:55:12.830219447-05:00","created_by":"daemon"},{"issue_id":"wl-wb1.9","depends_on_id":"wl-wb1.4","type":"blocks","created_at":"2026-01-02T10:58:28.754284811-05:00","created_by":"daemon"}]}
